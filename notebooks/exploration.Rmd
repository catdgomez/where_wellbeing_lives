---
title: "R Notebook"
output: html_notebook
---
Libraries I may use called
```{r}

library(tidyverse)
# install for visualizations 
library(ggplot2)
# install to combine date and time
library(lubridate)
# for melting a df
library(reshape)

```
### Perceived Health Status

Reading in the first dataset, perceived health status.
 
```{r}
perceived_health_status <- read_csv("../data/perceived_health_status.csv")
# dnmk <- read_csv("../data/denmark_only_phs.csv")
# perceived_health_status_once <- read_csv("../data/perceived_health_status_once.csv")

```
Inspecting the denmark only data:

```{r}
dnmk %>% 
  filter(Sex == "Total")
```

It appears that then 


Inspecting the perceived health data:

```{r}
perceived_health_status %>% 
  filter(`Reference area` == "Denmark")
```

Inspect original perceived health data:
```{r}
perceived_health_status_once%>% 
  filter(`Reference area` == "Denmark")
```
```{r}
perceived_health_status
```


Filtering.

```{r}

perceived_health_status_stripped <- perceived_health_status %>% 
  filter(TIME_PERIOD == 2022) %>% 
  filter(REF_AREA == "AUT") %>% 
  filter(Sex == "Total") %>% 
  filter(Age == "15 years or over")  

perceived_health_status_stripped

```
As it appears that after 2007, the number of observations are more significant in number, I will limit my data to 2007 and later. But, since it appears the number of observations drops off in 2024, I will limit my data to a range of 2007-2023. As well, I want to capture all genders and ages. (Corrected "==" to be "%in%" and that corrected much the problem I was running into.)

```{r}

# input code to limit year range, age range, and gender in perceived health status data

phs <- perceived_health_status %>% 
  filter(TIME_PERIOD %in% c(2007:2023)) %>% 
  filter(Sex == "Total") %>% 
  filter(Age == "15 years or over")

phs

```
It turns out that Denmark's data comes only from a population of 15-24 year old, which would be excluded when I filter for age range collective/Total. (Corrected "==" to be "%in%" which corrected what I was seeing.)

```{r}

perceived_health_status_once %>% 
  # filter(TIME_PERIOD == 2007) %>% 
  filter(TIME_PERIOD %in% c(2007:2023)) %>% 
  filter(Sex == "Total") %>% 
  filter(AGE == "Y_GE15") #%>%
  # filter(`Reference area` == "Denmark")

```

```{r}

sort(unique(perceived_health_status_once$Age))

perceived_health_status_once %>% 
  group_by(AGE) %>%
  summarize(n=n())

```


Inspect the data for the number of years it covers.

```{r}

barplot(table(perceived_health_status$TIME_PERIOD), main = "number of observations of year in the data")


```

Inspect the data for the number of age categories it covers.
```{r}
barplot(table(perceived_health_status$Age), main = "number of observations of age groups in the data")
```

Inspecting the data for balance in the health status column.

```{r}

phs %>% 
  group_by(HEALTH_STATUS) %>% 
  summarize(n=n())

```

Which countries are most heavily represented in the data? Denmark was selected to be included I will download a Denmark only data and investigate why it is no longer located in this data. 

```{r}

phs %>% 
  group_by(`Reference area`) %>%
  summarize(n=n())

```

```{r}
phs %>% 
  group_by(AGE) %>%
  summarize(n=n())

```

The final state of my Perceived Health Status data will be:
```{r}

phs

```



### Education Levels



Reading in the second dataset, education levels.

```{r}

# education_level <- read_csv("../data/educational_attainment_distribution_age_gender.csv")
# education_levels_defined <- read_csv("../data/educational_attainment_distribution.csv")
education_levels_three <- read_csv("../data/educational_attainment.csv")

```

Early data exploration in the education data

```{r}
el_third <- education_levels_three %>% 
  filter(Sex == "Total") %>% 
  filter(Age == "From 25 to 64 years") %>% 
  filter(TIME_PERIOD == 2010) %>% 
  filter(OBS_STATUS == "A") %>% 
  filter(REF_AREA == "AUT") %>% 
  filter(STATISTICAL_OPERATION == "OBS")

el_third
```


```{r}

# ISCED11A_5T8 = Tertiary education
# ISCED11A_3_4 = Upper secondary or post-secondary non-tertiary education
# ISCED11A_0T2 = Below upper secondary education
education_levels_three

```
Verify that there are simply three categories for the education level attained and  Education attainment level columns
```{r}

sort(unique(education_levels_three$ATTAINMENT_LEV))
sort(unique(education_levels_three$`Educational attainment level`))

```

```{r}
sort(unique(education_levels_three$STATISTICAL_OPERATION))
```
I want to use the observed values and not the standard error values at this time. 
```{r}

education_levels_three %>% 
  filter(STATISTICAL_OPERATION == "OBS")

```

I want to see the representation of countries in the data. Certain countries are significantly under represented.

```{r}
barplot(table(education_levels_three$`Reference area`), main = "number of observations of countries in the data")

```

```{r}
barplot(table(education_levels_three$TIME_PERIOD), main = "number of observations of year in the data")

```

check to see which years are present in the data. Base on the lack of data in the years prior to about 1998, I will limit the dataset to 1998-2024.

```{r}

sort(unique(education_levels_three$TIME_PERIOD))

education_levels_three_time <- education_levels_three %>% 
  filter(TIME_PERIOD %in% c(1998:2024))

```




I would like to discover which of the countries are under represented. 

```{r}
education_levels_three_time %>% 
  group_by(`Reference area`) %>%
  summarize(n=n())
```


I want to drop any countries whose count is less than 1800. 

```{r}

# count the frequency of each country
country_count <- table(education_levels_three_time$`Reference area`)

# I do not want any fewer rows for a country than this
num_in_data <- 1800

# which countries match or exceed that number
countries_to_keep <- names(country_count[country_count > num_in_data])

# filter the dataset to keep only rows of countries who are 
#represented in the data a certain number of times or more
education_levels_three_time_countries <- education_levels_three_time[education_levels_three_time$`Reference area` %in% countries_to_keep, ]

education_levels_three_time_countries 


```

Check out which ages are available to filter by.

```{r}
sort(unique(education_levels_three_time_countries$Age))
```

Check number of times each age range is represented in the data
```{r}

barplot(table(education_levels_three_time_countries$Age), main = "number of observations of age in the data")


```


Filter using all of the methods left that I want to filter by: all genders, ages, as well as only observed data, not the standard error.

```{r}

el_filtered <- education_levels_three_time_countries %>% 
  filter(Sex == "Total") %>% 
  filter(Age == "From 25 to 64 years") %>% 
  filter(STATISTICAL_OPERATION == "OBS")

```

The final state of my education level data will be:

```{r}
el_filtered
```

### Social and Community connection pulled from the Wellbeing dataset



```{r}

wellbeing_social<- read_csv("../data/current_wellbeing_exp.csv")

```



```{r}

# find unique values for Measure column
sort(unique(wellbeing_social$Measure))


```

```{r}
# sort(unique(el_secondary$`Educational attainment level`))
```

```{r}

# el_once   %>%  
  # group_by(`Educational attainment level`) %>%
  # summarize(n = n())

```


```{r}

# barplot(table(el_once$`Educational attainment level`), main = "number of observations of that education level in the data")

```


```{r}

safety_regions <- read_csv("../data/safety_regions.csv")


```
```{r}
safety_regions %>% 
  filter(TIME_PERIOD == 2010) %>% 
  filter(REF_AREA == "AUT") #%>% 
  # filter(Sex == "Total") %>% 
  # filter(Age == "15 years or over")  


```

```{r}

wellbeing_social %>% 
  filter(TIME_PERIOD == 2022) %>% 
  filter(REF_AREA == "AUT") #%>% 
  # filter(Unit)
```

```{r}


```

```{r}

```

